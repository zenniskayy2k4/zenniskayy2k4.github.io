<script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
<script>
  (function () {
    function initMermaid() {
      try {
        if (!window.mermaid) return;
        mermaid.initialize({ startOnLoad: false });
        if (typeof mermaid.init === 'function') {
          mermaid.init(undefined, document.querySelectorAll('.mermaid, .language-mermaid'));
        } else if (typeof mermaid.run === 'function') {
          mermaid.run();
        }
      } catch (e) {
        console.warn('mermaid init error:', e);
      }
    }

    if (document.readyState === 'complete' || document.readyState === 'interactive') {
      if (window.mermaid) {
        initMermaid();
      } else {
        var s = document.createElement('script');
        s.src = 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js';
        s.defer = true;
        s.onload = initMermaid;
        document.head.appendChild(s);
      }
    } else {
      window.addEventListener(
        'DOMContentLoaded',
        function () {
          if (window.mermaid) initMermaid();
          else {
            var s = document.createElement('script');
            s.src = 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js';
            s.defer = true;
            s.onload = initMermaid;
            document.head.appendChild(s);
          }
        },
        { once: true }
      );
    }
  })();
</script>
